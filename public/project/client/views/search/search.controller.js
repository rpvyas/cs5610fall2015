"use strict";
(function(){
    angular
        .module("NewsRoomApp")
        .controller("SearchController",SearchController);


    function SearchController($scope,$location,$rootScope, $http)
    {
        console.log("Search Controller function called!");
        //$scope.hello = "hello from header controller";
        $scope.$location = $location;

        //$scope.imageUrl = $rootScope.imageUrl;
        $scope.newsitems = $rootScope.newsitems;
        $scope.search = search;
        $scope.searchQuery = "";
        function mycallback(json)
        {
            console.log(json);
        }
        function search(SearchTitle)
        {
            var apiKey1 = "0d1a6d2a036e12cda6499d7689fbaf7ac78426ea";
            var apiKey2 = "d835b54524dd6f4fbf4b6e012d31e136119ed2ba";
            console.log("search funtion called");

            //SearchTitle =SearchTitle.replace(" ","%20");

            var searchObj;

            var url = "https://access.alchemyapi.com/calls/data/GetNews?apikey="+apiKey1+"&jsonp=JSON_CALLBACK&return=enriched.url.title,enriched.url.url,enriched.url.enrichedTitle.docSentiment&start=1443916800&end=1449097200&q.enriched.url.cleanedTitle="+SearchTitle+"&q.enriched.url.enrichedTitle.docSentiment.type=neutral&q.enriched.url.enrichedTitle.taxonomy.taxonomy_.label=news&count=25&outputMode=json";

            console.log("REQUEST URL");
            console.log(url);
            //$http.jsonp("http://access.alchemyapi.com/calls/data/GetNews?apikey="+apiKey2+"&start=1448409600&end=1449100000&jsonp=JSON_CALLBACK&outputMode=json&count=25&q.enriched.url.enrichedTitle.taxonomy.taxonomy_.label="+SearchTitle+"&return=enriched.url.url,enriched.url.title")
            //$http.jsonp("http://content.guardianapis.com/search?api-key=xcm8aahe2qcwhhvuztn6zuzd&section=sport&callback=JSON_CALLBACK")
            //$http.jsonp(url)
            //    .success(function(response){
            //        searchObj = response.result;
            //        console.log("SUCCESS!!!!");
            //        console.log(searchObj);
            //        var newsitems = searchObj.docs;
            //        var items = new Array();
            //        for(var i = 0; i<newsitems.length; i++)
            //        {
            //            var title = newsitems[i].source.enriched.url.title;
            //            var url = newsitems[i].source.enriched.url.url;
            //            //console.log(title);
            //            //console.log(url);
            //            var item = {}
            //            item.title = title;
            //            item.url = url;
            //            item.imageUrl = "http://41.media.tumblr.com/2b77fcc8b240c8f9b98dbe51c19fa60b/tumblr_ng0o0bnUit1rzligdo1_500.jpg";
            //            ////TODO change this
            //
            //            items.push(item);
            //        }
            //        console.log(items);
            //        $scope.newsitems = items;
            //        $rootScope.newsitems = items;
            //        console.log(items.length);
            //
            //        $location.path("/searchresults");
            //    });
            var imageResponse = '{"status": "OK","usage": "By accessing AlchemyAPI or using information generated by AlchemyAPI, you are agreeing to be bound by the AlchemyAPI Terms of Use: http://www.alchemyapi.com/company/terms.html","url": "http://astrophilosophy.tumblr.com/post/104295000981/bill-nye-sagittarius-sun-taurus-moon","totalTransactions": "2","image": "http://41.media.tumblr.com/2b77fcc8b240c8f9b98dbe51c19fa60b/tumblr_ng0o0bnUit1rzligdo1_500.jpg"}';

            var searchResponse= '{"status": "OK","usage":"By accessing AlchemyAPI or using information generated by AlchemyAPI, you are agreeing to be bound by the AlchemyAPI Terms of Use: http://www.alchemyapi.com/company/terms.html","totalTransactions": "241",  "result": {    "docs": [      {        "id": "NjIzODUxNDg4M3wxNDQ5MDk3MjAw",        "source": {          "enriched": {            "url": {              "title": "SUB General Meeting - Events Calendar - Iowa State University",              "url": "http://www.event.iastate.edu/event/36874"            }          }        },        "timestamp": 1449097200      },      {        "id": "ODAyNDk4Njk3MXwxNDQ5MDc4NTAx",        "source": {          "enriched": {            "url": {              "title": "Russia unveils sanctions list against Turkey",              "url": "http://famagusta-gazette.com/russia-unveils-sanctions-list-against-turkey-p31273-69.htm"            }          }        },        "timestamp": 1449078501      },      {        "id": "ODI5NTg3NTIxOXwxNDQ5MDczODI2",        "source": {          "enriched": {            "url": {              "title": "What do ad blockers mean for mobile apps?",              "url": "http://www.clickz.com/clickz/news/2434920/what-do-ad-blockers-mean-for-mobile-apps"            }          }        },        "timestamp": 1449073826      },      {        "id": "ODI5MzE5OTg5NnwxNDQ5MDczNjc4",        "source": {          "enriched": {            "url": {              "title": "MacNN Deals: Mac apps to make you more productive at work | MacNN",              "url": "http://www.macnn.com/articles/15/12/02/textexpander.5.app.bundles.available.today.at.macnn.deals.131503/"            }          }        },        "timestamp": 1449073678      },      {        "id": "ODI4ODA5NTI2M3wxNDQ5MDczNTkz",        "source": {          "enriched": {            "url": {              "title": "I would buy this purely as a watch: Motorola India GM on the new Moto 360 smartwatch",              "url": "http://indianexpress.com/article/technology/gadgets/i-would-buy-this-purely-as-a-watch-motorola-india-gm-on-the-new-moto-360-smartwatch/"            }          }        },        "timestamp": 1449073593      },      {        "id": "ODI4NzkxMzYzOXwxNDQ5MDczNTgw",        "source": {          "enriched": {            "url": {              "title": "Gunjack launches in the UK for Samsung Gear VR - VideoGamer.com",              "url": "http://www.videogamer.com/news/gunjack_launches_in_the_uk_for_samsung_gear_vr.html"            }          }        },        "timestamp": 1449073580      },      {        "id": "ODI5MTM0NzMwMXwxNDQ5MDczNTQz",        "source": {          "enriched": {            "url": {              "title": "MacNN Deals: Mac apps to make you more productive at work | MacNN",              "url": "http://www.macnn.com/articles/15/12/02/textexpander.5.app.bundles.available.today.at.macnn.deals.131503"            }          }        },        "timestamp": 1449073543      },      {        "id": "ODI4NzIwNjc1M3wxNDQ5MDczNTE3",        "source": {          "enriched": {            "url": {              "title": "European HTC One (M8) poised for update to Android 6.0, Sense 7 in just two weeks?",              "url": "http://www.phonearena.com/news/European-HTC-One-M8-poised-for-update-to-Android-6.0-Sense-7-in-just-two-weeks_id76332"            }          }        },        "timestamp": 1449073517      },      {        "id": "ODI3NjA4MTUzMXwxNDQ5MDczNDY0",        "source": {          "enriched": {            "url": {              "title": "I want to keep this phone, but..need help with bluetooth audio and texting, anyone? - Android Forums at AndroidCentral.com",              "url": "http://forums.androidcentral.com/nexus-6p/615663-i-want-keep-phone-but-need-help-bluetooth-audio-texting-anyone.html"            }          }        },        "timestamp": 1449073464      },      {        "id": "ODI5NDA1MDUxN3wxNDQ5MDczNDIz",        "source": {          "enriched": {            "url": {              "title": "Microsoft Lumia 950 XL Review: In Depth",              "url": "https://recombu.com/mobile/article/microsoft-lumia-950-xl-review"            }          }        },        "timestamp": 1449073423      },      {        "id": "ODI4ODgyMjQ3N3wxNDQ5MDczMzM1",        "source": {          "enriched": {            "url": {              "title": "A good app for location tracking of a smartphone - Windows Central Forums",              "url": "http://forums.windowscentral.com/windows-phone-apps/398008-good-app-location-tracking-smartphone.html"            }          }        },        "timestamp": 1449073335      },      {        "id": "ODI3MzgzMTU5N3wxNDQ5MDczMjk4",        "source": {          "enriched": {            "url": {              "title": "To Cuff or to Tether?",              "url": "https://www.psychologytoday.com/blog/the-puzzle-love/201512/cuff-or-tether"            }          }        },        "timestamp": 1449073298      },      {        "id": "ODI5MTYwMDE0MnwxNDQ5MDczMjA5",        "source": {          "enriched": {            "url": {              "title": "[Music] \u201CGOD\u201D Dee Black feat. Dre Murray & Eris Ford | Kingdom Time Media",              "url": "http://www.kingdomtimemedia.com/music-god-dee-black-feat-dre-murray-eris-ford/?utm_content=buffer7f030&utm_medium=social&utm_source=twitter.com&utm_campaign=buffer"            }          }        },        "timestamp": 1449073209      },      {        "id": "ODI5MDA3MDYzNXwxNDQ5MDczMTE3",        "source": {          "enriched": {            "url": {              "title": "BlackBerry\u2019s Priv gets its first monthly security update and some key camera fixes",              "url": "http://news.yahoo.com/blackberry-priv-gets-first-monthly-155026881.html"            }          }        },        "timestamp": 1449073117      },      {        "id": "ODI4NDY1MTcwOXwxNDQ5MDczMDI2",        "source": {          "enriched": {            "url": {              "title": "NFB-NEWSLINE\u00AE Releases iOS Mobile App Version 2.1 | Virtual-Strategy Magazine",              "url": "http://www.virtual-strategy.com/2015/12/02/nfb-newsline%C2%AE-releases-ios-mobile-app-version-21"            }          }        },        "timestamp": 1449073026      },      {        "id": "ODI3OTg1MDI1N3wxNDQ5MDczMDI0",        "source": {          "enriched": {            "url": {              "title": "Four-Fifths Of U.S. Use A Smartphone.",              "url": "http://www.insideradio.com/free/four-fifths-of-u-s-use-a-smartphone/article_38352ee2-98d9-11e5-bc6b-87aac52d852e.html"            }          }        },        "timestamp": 1449073024      },      {        "id": "ODI3OTM0NTMzN3wxNDQ5MDcyOTk2",        "source": {          "enriched": {            "url": {              "title": "SBS Takes Radio Streaming to the Next Level with the Introduction of LaMusica Mobile App | Virtual-Strategy Magazine",              "url": "http://www.virtual-strategy.com/2015/12/02/sbs-takes-radio-streaming-next-level-introduction-lamusica-mobile-app"            }          }        },        "timestamp": 1449072996      },      {        "id": "ODI4MzQ1MjI0MHwxNDQ5MDcyOTM0",        "source": {          "enriched": {            "url": {              "title": "U.S. CELLULAR OFFERS SOLUTIONS TO STAY HEALTHY THROUGHOUT THE HOLIDAYS - Peoria, IL",              "url": "http://www.americantowns.com/il/peoria/news/us-cellular-offers-solutions-to-stay-healthy-throughout-the-holidays-24715107"            }          }        },        "timestamp": 1449072934      },      {        "id": "ODI4NzE3NDM2MHwxNDQ5MDcyOTI0",        "source": {          "enriched": {            "url": {              "title": "Android Skew in Smartphone Market Varies in Asia-Pacific - eMarketer",              "url": "http://www.emarketer.com/Article/Android-Skew-Smartphone-Market-Varies-Asia-Pacific/1013292"            }          }        },        "timestamp": 1449072924      },      {        "id": "ODI4MTgxMTMxMnwxNDQ5MDcyODA5",        "source": {          "enriched": {            "url": {              "title": "The World\'s Most Portable Reading Glasses Nannini Readers From Heininger Are Stylish, Pocketable -- And They Fold Absolutely Flat For Easy Carrying",              "url": "http://www.prnewswire.com/news-releases/the-worlds-most-portable-reading-glasses-nannini-readers-from-heininger-are-stylish-pocketable----and-they-fold-absolutely-flat-for-easy-carrying-300186944.html"            }          }        },        "timestamp": 1449072809      },      {        "id": "ODI3MTE1Njc2M3wxNDQ5MDcyODA0",        "source": {          "enriched": {            "url": {              "title": "Twighlight for Android",              "url": "http://www.majorgeeks.com/files/details/twighlight_for_android.html"            }          }        },        "timestamp": 1449072804      },      {        "id": "ODI3NjAyOTg2NHwxNDQ5MDcyNzQy",        "source": {          "enriched": {            "url": {              "title": "BluFlux Earns Rigorous CTIA Certification",              "url": "http://www.tmcnet.com/usubmit/2015/12/02/8285434.htm"            }          }        },        "timestamp": 1449072742      },      {        "id": "ODI3ODQ5ODAwN3wxNDQ5MDcyNTUy",        "source": {          "enriched": {            "url": {              "title": "Surprise! Samsung hits us with three new Galaxy smartphones",              "url": "http://www.trustedreviews.com/news/samsung-galaxy-a3-a5-a7-release-date-2016-price"            }          }        },        "timestamp": 1449072552      },      {        "id": "ODI3MzYxNTEyOXwxNDQ5MDcyNTUx",        "source": {          "enriched": {            "url": {              "title": "HTC Vive Hands On - Virtual Reality is here",              "url": "http://www.clickonline.com/tech/htc-vive-hands-on--virtual-reality-is-here/33207"            }          }        },        "timestamp": 1449072551      },      {        "id": "ODI4MTY0MDY2NnwxNDQ5MDcyNTAy",        "source": {          "enriched": {            "url": {              "title": "Google Updates Chrome on Android to Save More Data",              "url": "http://www.adweek.com/socialtimes/google-updates-chrome-on-android-to-save-more-data/630863"            }          }        },        "timestamp": 1449072502      }    ],    "next": "Njg3NjUyMDExNDEyMzM3NzgzNnx8NzA0NzQ3MzI0ODI0NDgzOTg2MHxPREkzTXpZeE5URXlPWHd4TkRRNU1EY3lOVFV4fDEwNDczNDAxNjA4ODYzODIxODQyfE9ESTRNVFkwTURZMk5ud3hORFE1TURjeU5UQXl8MTUyMjg3NjI0ODUyODE0NzcxNDh8T0RJM01URTFOamMyTTN3eE5EUTVNRGN5T0RBMHwxNTkxMzk4MTExNDI1OTUwMjI1OHx8MTYxNjQ0MTg5ODE2OTk4ODA4NDZ8T0RJM09EUTVPREF3TjN3eE5EUTVNRGN5TlRVeQ",    "status": "OK"  }}';

            var imageObj = JSON.parse(imageResponse);
            var searchObj = JSON.parse(searchResponse);

            console.log(imageObj.image);
            console.log(searchObj.result)

            $scope.imageUrl = imageObj.image
            $rootScope.imageUrl = $scope.imageUrl;
            console.log($scope.imageUrl);
            var newsitems = searchObj.result.docs;
            var items = new Array();
            for(var i = 0; i<newsitems.length; i++)
            {
                var title = newsitems[i].source.enriched.url.title;
                var url = newsitems[i].source.enriched.url.url;
                //console.log(title);
                //console.log(url);
                var item = {}
                item.title = title;
                item.url = url;
                ////TODO change this
                item.imageUrl = $scope.imageUrl;
                items.push(item);
            }
            console.log(items);
            $scope.newsitems = items;
            $rootScope.newsitems = items;
            $scope.searchQuery = SearchTitle;
            console.log(items.length);
            $location.path("/searchresults");
        }


    }
})();
